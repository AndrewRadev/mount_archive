#! /usr/bin/env ruby

require 'dante'
require 'fileutils'

if ARGV.count < 1
  puts 'USAGE: umount_archive <directory_name>'
  exit(1)
end

dir_path     = ARGV.shift
archive_path = dir_path.chomp('.d')
full_path    = File.expand_path(archive_path)
identifier   = full_path.gsub(/[\/\s]/, '_')

Dante.run("mount_archive_#{identifier}", {
  :kill     => true,
  :pid_path => "/tmp/mount_archive_#{identifier}.pid"
})
